# Mosquitto MQTT Broker Configuration for PlantNanny
# =================================================
# This configuration implements the recommended MQTT architecture:
# - Topic structure: devices/<device_id>/data, devices/<device_id>/command, devices/<device_id>/status
# - Authentication via username/password
# - LWT (Last Will and Testament) for device status
# - QoS 1 for reliable delivery

# ===================
# Listener Configuration
# ===================

# Listener for standard MQTT (internal network)
listener 1883
protocol mqtt

# Listener for WebSocket (for web clients / Flutter web)
listener 9001
protocol websockets

# ===================
# Authentication
# ===================

# For development: set to true to allow anonymous connections
# For production: set to false and configure password_file
allow_anonymous false

# Password file for authentication
# Generate passwords with: mosquitto_passwd -c /mosquitto/config/passwd <username>
password_file /mosquitto/config/passwd

# ===================
# Access Control (ACL)
# ===================

# ACL file for topic-level access control
acl_file /mosquitto/config/acl

# ===================
# Persistence
# ===================

persistence true
persistence_location /mosquitto/data/

# Retain messages for status topics (LWT)
retained_persistence true

# ===================
# Logging
# ===================

log_dest stdout
log_type error
log_type warning
log_type notice
log_type information
log_type subscribe
log_type unsubscribe

# Log connection/disconnection events
connection_messages true

# ===================
# Connection Settings
# ===================

max_connections -1
max_keepalive 120

# ===================
# Message Settings
# ===================

# Maximum message size (256KB)
message_size_limit 262144

# Maximum QoS level
max_qos 2

# ===================
# LWT (Last Will and Testament) Support
# ===================
# LWT is automatically supported - clients set their will message on connect

# ===================
# Security Hardening (for production)
# ===================

# Uncomment these for TLS/SSL support
# listener 8883
# protocol mqtt
# cafile /mosquitto/certs/ca.crt
# certfile /mosquitto/certs/server.crt
# keyfile /mosquitto/certs/server.key
# require_certificate false
